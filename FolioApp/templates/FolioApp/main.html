{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Awsome Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />    

    <!-- Custom CSS code -->
    <link rel="stylesheet" type="text/css" href="{% static '/css/main.css' %}">
</head>
<body style="background-color:  #FADA5E;">

    {% include 'FolioApp/navbar.html' %}

    <div class="container-fluid" style="background-color:  #FADA5E;">
        <!-- Content here -->
        {% block content %}


        {% endblock %}
        <br>
        <div class="d-flex justify-content-center">
            <h4>Get in touch</h4>
        </div>
        <br>
    </div>


</body>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!-- D3 Library -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>


<!-- D3 Code to make a map -->

<script type="text/javascript">
/*
    var margin = {top: 10, left: 10, bottom: 10, right: 10}
        , width = parseInt(d3.select('#map').style('width'))
        , width = width - margin.left - margin.right
        , mapRatio = .5
        , height = width * mapRatio;

    console.log(width)

    var projection = d3.geoBoggs()
        .scale(width)
        .translate([width / 2, height / 2]);
        //.fitSize([width,height],countries);

    var pathGenerator = d3.geoPath()
        .projection(projection);  
    
    d3.select(window).on('resize', resize);


    //create graticles
    const graticule = d3.geoGraticule();


    d3.json("{% static '/geo/world110.json' %}")
        .then(function(data){ 
            // Convert topojson to usable in d3
            var countries = topojson.feature(data, data.objects.countries).features 
            var countriesCollection = topojson.feature(data, data.objects.countries)
            console.log(countriesCollection)
            console.log(countries)
            projection.fitSize([width,height],countriesCollection);

            // Create SVG and group "g"
            var svg = d3.select("#map")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g");   
            // Draw Map
            svg.selectAll(".country")
                .data(countries)
                .enter().append("path")
                .attr("class", "country")
                .attr("d", pathGenerator)
                //add class 'selected'
                .on('mouseover', function(d){
                    d3.select(this).classed("selected", true)
                        .style("fill", function() {
                            return "hsl(" + Math.random() * 360 + ",100%,75%)";
                            })
                        .transition()
                            .duration(500)
                            .ease(d3.easeElasticIn)
                            .style("fill", "black");
                })
                //remove class 'selected'
                //.on('mouseout', function(d){
                    //d3.select(this).classed("selected", false)
                //});
        });


    function resize() {
        console.log("window resized")
            // adjust things when the window size changes
            width = parseInt(d3.select('#map').style('width'));
            width = width - margin.left - margin.right;
            height = width * mapRatio;

            // update projection
            projection
                .translate([width / 2, height / 2])
                .scale(width)
                .fitSize([width,height],countriesCollection);

            var svg = d3.select("#map")
            // resize the map container
            svg
                .style('width', width + 'px')
                .style('height', height + 'px');

            // resize the map
            svg.selectAll('.countries').attr('d', pathGenerator);
    }

    /*
    function resize() {
        width = parseInt(d3.select('map').style('width', width));
        width = $(window).width() * .97;
        height = width/1.85;
    
        projection
            .scale([width/3.5])
            .translate([width/1,height*1.4]);

        
    d3.select("map").attr("width",width).attr("height",height);
    //d3.select("svg").attr("width",width).attr("height",height);
    
    d3.selectAll("path").attr('d', path);
        // resize the map
        //map.selectAll('.countries').attr('d', path);
    }
    */

    // End Responsive rectanlge



    var width = document.getElementById('map').clientWidth;
    //console.log(width)
    //this allows us to collect the width of the div where the SVG will go.
    var height = width / 2;//3.236;
    //I like to use the golden rectangle ratio if they work for my charts.

    // Create SVG and group "g"
    var svg = d3.select("#map")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g");

    // Create projection
    var projection = d3.geoFoucaut() // pick projection here geoBoggs geoCraig
        .translate([ width / 2, height / 2])
        .scale(120) //use scale to zoom in and out
        //.center([-73.94, 40.70]); // long, lat of NYC

    //Create a geo path generator using the projection above
    var pathGenerator = d3.geoPath()
        .projection(projection);


    //create graticles
    const graticule = d3.geoGraticule();

    console.log(graticule)


    //Loading GeoJSON data
    d3.json("{% static '/geo/world110.json' %}")
        .then(function(data){ 
            //console.log(data)

            // Convert topojson to usable in d3
            var countries = topojson.feature(data, data.objects.countries).features 
            //console.log(countries)

            svg.selectAll(".country")
                .data(countries)
                .enter().append("path")
                .attr("class", "country")
                .attr("d", pathGenerator)
                //add class 'selected'
                .on('mouseover', function(d){
                    d3.select(this).classed("selected", true)
                        .style("fill", function() {
                            return "hsl(" + Math.random() * 360 + ",100%,75%)";
                            })
                        .transition()
                            .duration(500)
                            .ease(d3.easeElasticIn)
                            .style("fill", "black");
                })
                //remove class 'selected'
                //.on('mouseout', function(d){
                    //d3.select(this).classed("selected", false)
                //});
        });

    // Graticule lines (behind the land)
    svg.selectAll(".graticule")
        .data(graticule.lines())
        .enter().append("path")
        .attr("class", "graticule")
        .attr("d", pathGenerator);
        
    svg.append("path")
        .datum(graticule.outline)
        .attr("class", "graticule outline")
        .attr("d", pathGenerator);  
        

    //We will build a basic function to handle window resizing.
    function resize() {
        width = document.getElementById('map').clientWidth;
        height = width / 3.236;
        console.log("width: ", width)
        console.log("height: ", height)
        d3.select('#map svg')
        .attr('width', width)
        .attr('height', height);
    }    

window.onresize = resize;
//Call our resize function if the window size is changed.


</script>


</html>